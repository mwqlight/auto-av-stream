global:
  scrape_interval: 15s
  evaluation_interval: 15s

rule_files:
  # - "first_rules.yml"
  # - "second_rules.yml"

scrape_configs:
  # AI服务监控
  - job_name: 'ai-service'
    metrics_path: '/actuator/prometheus'
    scrape_interval: 10s
    static_configs:
      - targets: ['ai-service:8080']
        labels:
          application: 'ai-service'
          environment: 'docker'

  # Prometheus自身监控
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  # Node Exporter（系统监控）
  - job_name: 'node-exporter'
    static_configs:
      - targets: ['node-exporter:9100']

alerting:
  alertmanagers:
    - static_configs:
        - targets:
          # - alertmanager:9093

# 告警规则
alerting_rules:
  groups:
    - name: ai-service-alerts
      rules:
        # AI服务宕机告警
        - alert: AIServiceDown
          expr: up{job="ai-service"} == 0
          for: 1m
          labels:
            severity: critical
          annotations:
            summary: "AI服务已宕机"
            description: "AI服务 {{ $labels.instance }} 已宕机超过1分钟"

        # 高错误率告警
        - alert: HighErrorRate
          expr: rate(http_server_requests_seconds_count{job="ai-service", outcome="SERVER_ERROR"}[5m]) > 0.05
          for: 2m
          labels:
            severity: warning
          annotations:
            summary: "AI服务错误率过高"
            description: "AI服务错误率超过5%"

        # 高响应时间告警
        - alert: HighResponseTime
          expr: histogram_quantile(0.95, rate(http_server_requests_seconds_bucket{job="ai-service"}[5m])) > 5
          for: 2m
          labels:
            severity: warning
          annotations:
            summary: "AI服务响应时间过高"
            description: "95%分位响应时间超过5秒"

        # 内存使用过高告警
        - alert: HighMemoryUsage
          expr: process_resident_memory_bytes{job="ai-service"} / 1024 / 1024 / 1024 > 4
          for: 2m
          labels:
            severity: warning
          annotations:
            summary: "AI服务内存使用过高"
            description: "内存使用超过4GB"